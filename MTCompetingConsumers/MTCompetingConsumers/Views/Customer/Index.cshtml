@{
    ViewBag.Title = "Customer";
}

<h2>Customer</h2>

<div class="container">
    <input type="text" id="message" />
    <input type="button" class="btn-primary" id="sendmessage" value="Individual Order From Cashier"/>
    
    <input type="button" class="btn-sec" id="bulksendmessage" value="Bulk Order" />
    <ul id="discussion"></ul>
</div>


@section Scripts {

    <link href="~/Content/toastr.css" rel="stylesheet" />

    <!--Reference the jQuery library. -->
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>

    <!--Reference ToastR-->
    <script src="~/Scripts/toastr.js"></script>

    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.0.min.js"></script>

    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>


    <script>
        $(function () {
            // Declare a proxy to reference the hubs
            var customerHub = $.connection.customerHub; //note specific hub override
            
            // Create a function that the hub can call to broadcast messages to us
            customerHub.client.broadcastMessage = function (name, message) {
                // Html encode display name and message. 
                var encodedName = $('<div />').text(name).html();
                var encodedMsg = $('<div />').text(message).html();
                // Add the message to the page. 
                $('#discussion').append('<li><strong>' + encodedName
                    + '</strong>:&nbsp;&nbsp;' + encodedMsg + '</li>');

                toastr.info(encodedMsg, encodedName);
            };


            // Start the connection, add a state changed handler for debug purpose
            var src = $.connection.hub; //note generic hub
            src.stateChanged(connectionStateChanged);
            src.start().done(notifyConnectionReady);


            $("#sendmessage").click(function () {
                // Call the Send method on the hub. 
                customerHub.server.send($('#message').val());
                // Clear text box and reset focus. 
                $('#message').val('').focus();
            });

            $("#bulksendmessage").click(function () {
                // Call the Send method on the hub. 
                customerHub.server.bulkSend();
                // Clear text box and reset focus. 
                $('#message').val('').focus();
            });
            
        });

        //trap state changes when signalR server goes down
        function connectionStateChanged(state) {
            var stateConversion = {
                0: 'Connecting',
                1: 'Connected',
                2: 'Reconnecting',
                4: 'Disconnected'
            };

            if (console) {
                console.log(stateConversion[state.newState]);
            }
        }

        function notifyConnectionReady() {
            if (window.connectionReady) {
                window.connectionReady();
            }
        }


    </script>
}
